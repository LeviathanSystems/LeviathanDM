{{/* Version Selector Component */}}
{{ $currentVersion := .Scratch.Get "currentVersion" | default "latest" }}
{{ $versions := .Site.Data.versions.versions.entries }}

<div class="version-selector">
  <button class="version-selector-button" id="versionButton" aria-label="Select documentation version">
    <svg class="version-icon" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
      <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
    </svg>
    <span class="version-label">{{ range $versions }}{{ if eq .name $currentVersion }}{{ .title }}{{ end }}{{ end }}</span>
    <svg class="version-arrow" width="12" height="12" fill="currentColor" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"/>
    </svg>
  </button>
  
  <div class="version-dropdown" id="versionDropdown">
    {{ range $versions }}
    <a href="{{ .path }}" 
       class="version-option{{ if eq .name $currentVersion }} active{{ end }}"
       data-version="{{ .name }}">
      <div class="version-option-content">
        <span class="version-name">{{ .title }}</span>
        {{ if .badge }}
        <span class="version-badge" style="background-color: {{ .badge_color }}">{{ .badge }}</span>
        {{ end }}
      </div>
    </a>
    {{ end }}
  </div>
</div>

<style>
.version-selector {
  position: relative;
  margin: 1rem 0;
  z-index: 100;
}

.version-selector-button {
  display: flex;
  align-items: center;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  background: var(--gray-100);
  border: 1px solid var(--gray-300);
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.9rem;
  width: 100%;
  transition: all 0.2s;
}

.version-selector-button:hover {
  background: var(--gray-200);
  border-color: var(--gray-400);
}

.version-icon, .version-arrow {
  flex-shrink: 0;
}

.version-label {
  flex: 1;
  text-align: left;
  font-weight: 500;
}

.version-dropdown {
  position: absolute;
  top: calc(100% + 0.25rem);
  left: 0;
  right: 0;
  background: var(--body-background);
  border: 1px solid var(--gray-300);
  border-radius: 6px;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
  display: none;
  overflow: hidden;
}

.version-dropdown.show {
  display: block;
}

.version-option {
  display: block;
  padding: 0.75rem 1rem;
  text-decoration: none;
  color: var(--body-font-color);
  transition: background 0.2s;
  border-bottom: 1px solid var(--gray-200);
}

.version-option:last-child {
  border-bottom: none;
}

.version-option:hover {
  background: var(--gray-100);
}

.version-option.active {
  background: var(--color-link);
  color: white;
}

.version-option.active .version-badge {
  background: rgba(255, 255, 255, 0.3) !important;
}

.version-option-content {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.5rem;
}

.version-name {
  font-weight: 500;
}

.version-badge {
  font-size: 0.7rem;
  padding: 0.15rem 0.5rem;
  border-radius: 12px;
  color: white;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

/* Dark mode adjustments */
:root[data-theme="dark"] .version-selector-button {
  background: var(--gray-800);
  border-color: var(--gray-600);
}

:root[data-theme="dark"] .version-selector-button:hover {
  background: var(--gray-700);
  border-color: var(--gray-500);
}

:root[data-theme="dark"] .version-dropdown {
  background: var(--gray-800);
  border-color: var(--gray-600);
}

:root[data-theme="dark"] .version-option:hover {
  background: var(--gray-700);
}

:root[data-theme="dark"] .version-option {
  border-bottom-color: var(--gray-700);
}
</style>

<script>
(function() {
  const button = document.getElementById('versionButton');
  const dropdown = document.getElementById('versionDropdown');
  
  if (button && dropdown) {
    button.addEventListener('click', function(e) {
      e.stopPropagation();
      dropdown.classList.toggle('show');
    });
    
    // Close dropdown when clicking outside
    document.addEventListener('click', function() {
      dropdown.classList.remove('show');
    });
    
    // Prevent dropdown from closing when clicking inside it
    dropdown.addEventListener('click', function(e) {
      e.stopPropagation();
    });
  }
})();
</script>
